<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Profile Live - OAuth</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .container {
            min-height: 100vh;
            position: relative;
            transition: background 0.5s ease;
        }

        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            transition: all 0.6s ease;
        }

        .background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: inherit;
            filter: blur(100px);
            opacity: 0.6;
        }

        .noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.03;
            z-index: 1;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        .content {
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .login-card, .profile-card {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 2.5rem;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3),
                        0 0 0 1px rgba(255, 255, 255, 0.05),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
            animation: slideIn 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-title {
            font-size: 2rem;
            font-weight: 800;
            color: white;
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
        }

        .discord-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            background: linear-gradient(135deg, #5865F2, #7289DA);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            box-shadow: 0 8px 24px rgba(88, 101, 242, 0.4);
        }

        .login-button {
            width: 100%;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, #5865F2, #7289DA);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            box-shadow: 0 4px 16px rgba(88, 101, 242, 0.3);
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(88, 101, 242, 0.4);
        }

        .login-button:active {
            transform: translateY(0);
        }

        .info-box {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.6;
        }

        .info-box strong {
            color: white;
            display: block;
            margin-bottom: 0.5rem;
        }

        .feature-list {
            margin-top: 0.5rem;
            padding-left: 1.25rem;
        }

        .feature-list li {
            margin-bottom: 0.25rem;
        }

        .warning {
            margin-top: 1rem;
            padding: 0.75rem;
            background: rgba(237, 66, 69, 0.1);
            border: 1px solid rgba(237, 66, 69, 0.3);
            border-radius: 8px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
        }

        .setup-instructions {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .setup-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
            margin-bottom: 1rem;
        }

        .setup-steps {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.8;
        }

        .setup-steps ol {
            padding-left: 1.5rem;
        }

        .setup-steps li {
            margin-bottom: 0.75rem;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.5rem;
            border-radius: 6px;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            margin: 0.5rem 0;
            color: #4ade80;
            word-break: break-all;
        }

        .highlight {
            color: #60a5fa;
            font-weight: 600;
        }

        .profile-card {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 1.75rem;
            width: 100%;
            max-width: 380px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3),
                        0 0 0 1px rgba(255, 255, 255, 0.05),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
            animation: fadeInScale 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform;
        }

        .profile-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4),
                        0 0 0 1px rgba(255, 255, 255, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .avatar-container {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto 1.25rem;
        }

        .avatar-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            overflow: visible;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform;
        }

        .avatar-wrapper:hover {
            transform: scale(1.05) translateY(-4px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.5);
        }

        .avatar {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform;
        }

        .avatar-wrapper:hover .avatar {
            transform: scale(1.03);
        }

        .status-indicator {
            position: absolute;
            bottom: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 3px solid rgba(0, 0, 0, 0.8);
            background: #747f8d;
            z-index: 3;
        }

        .status-indicator.online { background: #3ba55d; }

        .user-info {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .username {
            font-size: 1.4rem;
            font-weight: 800;
            color: white;
            margin-bottom: 0.3rem;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .discriminator {
            font-family: 'Space Mono', monospace;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.85rem;
        }

        .badges {
            display: flex;
            justify-content: center;
            gap: 0.4rem;
            margin-top: 0.75rem;
            flex-wrap: wrap;
            animation: fadeIn 0.8s ease 0.3s both;
        }

        .badge {
            width: 22px;
            height: 22px;
            transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1),
                        filter 0.25s ease;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
            animation: fadeInScale 0.5s ease backwards;
            will-change: transform;
        }

        .badge:nth-child(1) { animation-delay: 0.1s; }
        .badge:nth-child(2) { animation-delay: 0.15s; }
        .badge:nth-child(3) { animation-delay: 0.2s; }
        .badge:nth-child(4) { animation-delay: 0.25s; }
        .badge:nth-child(5) { animation-delay: 0.3s; }

        .badge:hover {
            transform: scale(1.2) translateY(-2px);
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4)) brightness(1.1);
        }

        .customizer {
            position: fixed;
            top: 0;
            right: -320px;
            height: 100vh;
            z-index: 10;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(40px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem 1.5rem;
            width: 320px;
            box-shadow: -8px 0 32px rgba(0, 0, 0, 0.5);
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }

        .customizer.open {
            right: 0;
        }

        .customizer h3 {
            color: white;
            font-weight: 700;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .section {
            margin-bottom: 2rem;
        }

        .section-title {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .bg-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }

        .bg-option {
            aspect-ratio: 1;
            border-radius: 12px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .bg-option:hover {
            transform: scale(1.05);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .bg-option.active {
            border-color: white;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .menu-toggle {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 11;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-size: 1.5rem;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .menu-toggle:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.1);
        }

        .menu-toggle.open {
            right: 336px;
        }

        .activity-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            padding: 1rem;
            margin-top: 1rem;
            animation: slideInFromRight 0.5s cubic-bezier(0.16, 1, 0.3, 1) backwards;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .activity-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transform: translateX(4px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .activity-card:nth-child(1) { animation-delay: 0.1s; }
        .activity-card:nth-child(2) { animation-delay: 0.2s; }
        .activity-card:nth-child(3) { animation-delay: 0.3s; }

        .activity-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .activity-image {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            object-fit: cover;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .activity-card:hover .activity-image {
            transform: scale(1.05) rotate(2deg);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .activity-details {
            flex: 1;
            min-width: 0;
        }

        .activity-name {
            font-weight: 700;
            color: white;
            font-size: 1rem;
            margin-bottom: 0.2rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .activity-state,
        .activity-info {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.15rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .timestamps {
            margin-top: 0.6rem;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            font-family: 'Space Mono', monospace;
        }

        .spotify-bar {
            margin-top: 0.75rem;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .spotify-progress {
            height: 100%;
            background: linear-gradient(90deg, #1db954, #1ed760);
            border-radius: 2px;
            transition: width 1s linear;
        }

        /* Corações flutuantes Hello Kitty */
        .hello-kitty-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .heart {
            position: absolute;
            width: 15px;
            height: 15px;
            opacity: 0.5;
            animation: floatHeart 8s infinite ease-in-out;
            will-change: transform, opacity;
            pointer-events: none;
        }

        @keyframes floatHeart {
            0% {
                transform: translateY(100vh) translateX(0) scale(0);
                opacity: 0;
            }
            5% {
                opacity: 0.5;
            }
            10% {
                transform: translateY(90vh) translateX(10px) scale(1);
                opacity: 0.6;
            }
            90% {
                opacity: 0.5;
                transform: translateY(10vh) translateX(-10px) scale(1);
            }
            95% {
                opacity: 0.2;
            }
            100% {
                transform: translateY(-10vh) translateX(0) scale(0);
                opacity: 0;
            }
        }

        /* Loading Skeleton */
        .skeleton {
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.05) 0%,
                rgba(255, 255, 255, 0.15) 50%,
                rgba(255, 255, 255, 0.05) 100%
            );
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }

        .skeleton-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 1.25rem;
        }

        .skeleton-text {
            height: 20px;
            margin-bottom: 0.5rem;
        }

        .skeleton-text.short {
            width: 60%;
            margin: 0 auto 0.5rem;
        }

        .skeleton-text.medium {
            width: 40%;
            margin: 0 auto;
        }

        /* Efeito Scanlines Cyberpunk */
        .cyberpunk-scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 255, 255, 0.03) 0px,
                transparent 1px,
                transparent 2px,
                rgba(0, 255, 255, 0.03) 3px
            );
            animation: scanlines 8s linear infinite;
        }

        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(10px); }
        }

        /* Bolhas Ocean */
        .ocean-bubbles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .bubble {
            position: absolute;
            bottom: -100px;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8), rgba(0, 212, 255, 0.3));
            border-radius: 50%;
            opacity: 0.5;
            animation: floatBubble 8s infinite ease-in;
            will-change: transform, opacity;
            pointer-events: none;
        }

        @keyframes floatBubble {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 0.5;
            }
            90% {
                opacity: 0.4;
            }
            100% {
                transform: translateY(-100vh) translateX(30px);
                opacity: 0;
            }
        }

        /* Text Shadow para tema Cyberpunk */
        .text-glow {
            text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
        }

        /* Theme Editor Modal */
        .theme-editor-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            animation: fadeIn 0.3s ease;
        }

        .theme-editor {
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .theme-editor h2 {
            color: white;
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
        }

        .editor-group {
            margin-bottom: 1.5rem;
        }

        .editor-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .editor-input {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .editor-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .color-input {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .color-input input[type="color"] {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .editor-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 2rem;
        }

        .editor-button {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .editor-button.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .editor-button.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .editor-button.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .editor-button.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function DiscordOAuthProfile() {
            const [accessToken, setAccessToken] = useState(null);
            const [userData, setUserData] = useState(null);
            const [guilds, setGuilds] = useState([]);
            const [loading, setLoading] = useState(true);
            const [background, setBackground] = useState(
                parseInt(localStorage.getItem('selectedBg')) || 1
            );
            const [customBackground, setCustomBackground] = useState(
                localStorage.getItem('customBackground') || null
            );
            const [menuOpen, setMenuOpen] = useState(false);
            const [currentTheme, setCurrentTheme] = useState(
                localStorage.getItem('selectedTheme') || 'default'
            );
            const [activities, setActivities] = useState([]);
            const [spotifyData, setSpotifyData] = useState(null);
            const [lanyardData, setLanyardData] = useState(null);
            const [spotifyProgress, setSpotifyProgress] = useState(0);
            const [publicUserId, setPublicUserId] = useState(null);
            const [isPublicView, setIsPublicView] = useState(false);
            const [error, setError] = useState(null);
            const [showThemeEditor, setShowThemeEditor] = useState(false);
            const [customThemes, setCustomThemes] = useState(
                JSON.parse(localStorage.getItem('customThemes') || '{}')
            );
            const [editingTheme, setEditingTheme] = useState(null);
            const fileInputRef = React.useRef(null);
            const wsRef = React.useRef(null);
            const progressIntervalRef = React.useRef(null);

            // Limpar efeitos de temas anteriores ao trocar
            useEffect(() => {
                // Forçar re-render do background ao trocar tema
                const container = document.querySelector('.container');
                if (container) {
                    container.style.opacity = '0.99';
                    setTimeout(() => {
                        container.style.opacity = '1';
                    }, 10);
                }
            }, [currentTheme]);

            // Verificar se tem ID público na URL
            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const userId = urlParams.get('id');
                
                if (userId) {
                    setPublicUserId(userId);
                    setIsPublicView(true);
                    fetchPublicUserData(userId);
                }
            }, []);

            // Configurações do Discord OAuth2
            const CLIENT_ID = '1467351282493947994';
            const REDIRECT_URI = window.location.origin + window.location.pathname;
            const SCOPES = 'identify guilds';

            const backgrounds = [
                { id: 1, style: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', name: 'Purple Dream' },
                { id: 2, style: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', name: 'Pink Sunset' },
                { id: 3, style: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', name: 'Ocean Blue' },
                { id: 4, style: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', name: 'Mint Fresh' },
                { id: 5, style: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', name: 'Peach Glow' },
                { id: 6, style: 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)', name: 'Deep Ocean' },
                { id: 7, style: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)', name: 'Cotton Candy' },
                { id: 8, style: 'linear-gradient(135deg, #ff9a56 0%, #ff6a88 50%, #c060ff 100%)', name: 'Neon Sunset' },
                { id: 9, style: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)', name: 'Dark Night' },
            ];

            // Sistema de Temas Completos
            const themes = {
                default: {
                    name: 'Padrão',
                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    cardBg: 'rgba(0, 0, 0, 0.4)',
                    cardBorder: 'rgba(255, 255, 255, 0.1)',
                    textPrimary: '#ffffff',
                    textSecondary: 'rgba(255, 255, 255, 0.7)',
                    textTertiary: 'rgba(255, 255, 255, 0.5)',
                    accent: '#667eea',
                    spotifyBar: 'linear-gradient(90deg, #1db954, #1ed760)',
                    activityBg: 'rgba(255, 255, 255, 0.05)',
                    activityBorder: 'rgba(255, 255, 255, 0.1)',
                },
                hellokitty: {
                    name: 'Hello Kitty',
                    background: `
                        #FFE4E8 url("data:image/svg+xml,%3Csvg width='60' height='60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23FFB6C1' fill-opacity='0.15'%3E%3Ccircle cx='30' cy='15' r='2'/%3E%3Ccircle cx='45' cy='30' r='2'/%3E%3Ccircle cx='15' cy='45' r='2'/%3E%3Cpath d='M10,10 Q15,5 20,10 Q15,15 10,10' fill='%23FF69B4' fill-opacity='0.2'/%3E%3Cpath d='M40,25 Q45,20 50,25 Q45,30 40,25' fill='%23FF69B4' fill-opacity='0.2'/%3E%3Cpath d='M25,40 Q30,35 35,40 Q30,45 25,40' fill='%23FF69B4' fill-opacity='0.2'/%3E%3C/g%3E%3C/svg%3E")
                    `,
                    cardBg: 'rgba(255, 255, 255, 0.95)',
                    cardBorder: 'rgba(255, 182, 193, 0.5)',
                    textPrimary: '#FF1493',
                    textSecondary: '#FF69B4',
                    textTertiary: '#FFB6C1',
                    accent: '#FF1493',
                    spotifyBar: 'linear-gradient(90deg, #FF1493, #FF69B4)',
                    activityBg: 'rgba(255, 182, 193, 0.2)',
                    activityBorder: 'rgba(255, 105, 180, 0.3)',
                    customStyles: {
                        fontFamily: "'Comic Sans MS', 'Chalkboard SE', 'Comic Neue', cursive",
                        badgeFilter: 'hue-rotate(330deg) saturate(1.5)',
                        avatarBorder: '4px solid #FF1493',
                        cardShadow: '0 8px 32px rgba(255, 20, 147, 0.3), 0 0 0 1px rgba(255, 105, 180, 0.2)',
                    }
                },
                cyberpunk: {
                    name: 'Cyberpunk',
                    background: `
                        #0a0a0a url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='grid' width='50' height='50' patternUnits='userSpaceOnUse'%3E%3Cpath d='M 50 0 L 0 0 0 50' fill='none' stroke='%2300ffff' stroke-width='0.5' opacity='0.3'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100' height='100' fill='url(%23grid)'/%3E%3C/svg%3E")
                    `,
                    cardBg: 'rgba(10, 10, 10, 0.9)',
                    cardBorder: 'rgba(0, 255, 255, 0.5)',
                    textPrimary: '#00ffff',
                    textSecondary: '#ff00ff',
                    textTertiary: '#ffff00',
                    accent: '#00ffff',
                    spotifyBar: 'linear-gradient(90deg, #00ffff, #ff00ff)',
                    activityBg: 'rgba(0, 255, 255, 0.05)',
                    activityBorder: 'rgba(0, 255, 255, 0.3)',
                    customStyles: {
                        fontFamily: "'Courier New', 'Consolas', monospace",
                        cardShadow: '0 0 30px rgba(0, 255, 255, 0.3), 0 8px 32px rgba(0, 0, 0, 0.8)',
                        avatarBorder: '3px solid #00ffff',
                        textShadow: '0 0 10px currentColor',
                    }
                },
                minimal: {
                    name: 'Minimalista',
                    background: '#f5f5f5',
                    cardBg: 'rgba(255, 255, 255, 0.95)',
                    cardBorder: 'rgba(0, 0, 0, 0.1)',
                    textPrimary: '#1a1a1a',
                    textSecondary: '#666666',
                    textTertiary: '#999999',
                    accent: '#1a1a1a',
                    spotifyBar: 'linear-gradient(90deg, #1a1a1a, #666666)',
                    activityBg: 'rgba(0, 0, 0, 0.03)',
                    activityBorder: 'rgba(0, 0, 0, 0.08)',
                    customStyles: {
                        fontFamily: "'Inter', 'Helvetica Neue', sans-serif",
                        cardShadow: '0 2px 20px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(0, 0, 0, 0.05)',
                        avatarBorder: '2px solid #1a1a1a',
                    }
                },
                darkpremium: {
                    name: 'Dark Premium',
                    background: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)',
                    cardBg: 'rgba(20, 20, 20, 0.95)',
                    cardBorder: 'rgba(212, 175, 55, 0.3)',
                    textPrimary: '#D4AF37',
                    textSecondary: '#ffffff',
                    textTertiary: 'rgba(255, 255, 255, 0.6)',
                    accent: '#D4AF37',
                    spotifyBar: 'linear-gradient(90deg, #D4AF37, #FFD700)',
                    activityBg: 'rgba(212, 175, 55, 0.05)',
                    activityBorder: 'rgba(212, 175, 55, 0.2)',
                    customStyles: {
                        fontFamily: "'Playfair Display', 'Georgia', serif",
                        cardShadow: '0 8px 32px rgba(212, 175, 55, 0.2), 0 0 0 1px rgba(212, 175, 55, 0.1)',
                        avatarBorder: '3px solid #D4AF37',
                        badgeFilter: 'brightness(1.3) saturate(1.2)',
                    }
                },
                ocean: {
                    name: 'Ocean',
                    background: `
                        linear-gradient(135deg, #0077be 0%, #00a8cc 50%, #0096c7 100%)
                    `,
                    cardBg: 'rgba(0, 119, 190, 0.25)',
                    cardBorder: 'rgba(0, 168, 204, 0.4)',
                    textPrimary: '#ffffff',
                    textSecondary: '#b3e5fc',
                    textTertiary: 'rgba(255, 255, 255, 0.7)',
                    accent: '#00d4ff',
                    spotifyBar: 'linear-gradient(90deg, #00d4ff, #00ffcc)',
                    activityBg: 'rgba(0, 212, 255, 0.1)',
                    activityBorder: 'rgba(0, 212, 255, 0.3)',
                    customStyles: {
                        cardShadow: '0 8px 32px rgba(0, 119, 190, 0.4), 0 0 0 1px rgba(0, 168, 204, 0.2)',
                        avatarBorder: '3px solid #00d4ff',
                    }
                }
            };

            // Verificar token na URL
            useEffect(() => {
                const hash = window.location.hash;
                if (hash) {
                    const params = new URLSearchParams(hash.substring(1));
                    const token = params.get('access_token');
                    
                    if (token) {
                        setAccessToken(token);
                        localStorage.setItem('discord_token', token);
                        window.location.hash = ''; // Limpar URL
                    }
                } else {
                    const savedToken = localStorage.getItem('discord_token');
                    if (savedToken) {
                        setAccessToken(savedToken);
                    } else {
                        setLoading(false);
                    }
                }
            }, []);

            // Buscar dados do usuário
            useEffect(() => {
                if (accessToken) {
                    fetchUserData();
                    fetchGuilds();
                }
            }, [accessToken]);

            const fetchUserData = async () => {
                try {
                    const response = await fetch('https://discord.com/api/users/@me', {
                        headers: {
                            Authorization: `Bearer ${accessToken}`
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        setUserData(data);
                        setLoading(false);
                    } else if (response.status === 401) {
                        // Token inválido
                        handleLogout();
                    }
                } catch (error) {
                    console.error('Erro ao buscar dados:', error);
                    setLoading(false);
                }
            };

            const fetchGuilds = async () => {
                try {
                    const response = await fetch('https://discord.com/api/users/@me/guilds', {
                        headers: {
                            Authorization: `Bearer ${accessToken}`
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        setGuilds(data);
                    }
                } catch (error) {
                    console.error('Erro ao buscar servidores:', error);
                }
            };

            const handleLogin = () => {
                const authUrl = `https://discord.com/api/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=${encodeURIComponent(SCOPES)}`;
                window.location.href = authUrl;
            };

            const handleLogout = () => {
                localStorage.removeItem('discord_token');
                setAccessToken(null);
                setUserData(null);
                setGuilds([]);
                setLoading(false);
            };

            // Buscar dados de usuário público via Lanyard REST API
            const fetchPublicUserData = async (userId) => {
                try {
                    setLoading(true);
                    const response = await fetch(`https://api.lanyard.rest/v1/users/${userId}`);
                    
                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            const data = result.data;
                            
                            // Simular estrutura de userData
                            setUserData({
                                id: data.discord_user.id,
                                username: data.discord_user.username,
                                global_name: data.discord_user.global_name,
                                discriminator: data.discord_user.discriminator,
                                avatar: data.discord_user.avatar,
                                public_flags: data.discord_user.public_flags,
                                premium_type: data.discord_user.premium_type
                            });
                            
                            setLanyardData(data);
                            
                            if (data.activities) {
                                setActivities(data.activities);
                            }
                            
                            if (data.spotify) {
                                setSpotifyData(data.spotify);
                                updateSpotifyProgress(data.spotify);
                            }
                            
                            setLoading(false);
                        } else {
                            setError('Usuário não encontrado no Lanyard');
                            setLoading(false);
                        }
                    } else {
                        setError('Usuário não encontrado');
                        setLoading(false);
                    }
                } catch (error) {
                    console.error('Erro ao buscar usuário público:', error);
                    setError('Erro ao carregar perfil');
                    setLoading(false);
                }
            };

            const handleBackgroundChange = (bgId) => {
                setBackground(bgId);
                setCustomBackground(null);
                localStorage.setItem('selectedBg', bgId);
                localStorage.removeItem('customBackground');
            };

            const handleThemeChange = (themeId) => {
                setCurrentTheme(themeId);
                localStorage.setItem('selectedTheme', themeId);
                // Resetar background customizado ao trocar tema
                setCustomBackground(null);
                localStorage.removeItem('customBackground');
            };

            const createNewTheme = () => {
                const newTheme = {
                    name: 'Meu Tema',
                    background: '#667eea',
                    cardBg: 'rgba(0, 0, 0, 0.4)',
                    cardBorder: 'rgba(255, 255, 255, 0.1)',
                    textPrimary: '#ffffff',
                    textSecondary: 'rgba(255, 255, 255, 0.7)',
                    textTertiary: 'rgba(255, 255, 255, 0.5)',
                    accent: '#667eea',
                    spotifyBar: 'linear-gradient(90deg, #1db954, #1ed760)',
                    activityBg: 'rgba(255, 255, 255, 0.05)',
                    activityBorder: 'rgba(255, 255, 255, 0.1)',
                };
                setEditingTheme(newTheme);
                setShowThemeEditor(true);
            };

            const saveCustomTheme = (themeName, themeData) => {
                const newCustomThemes = {
                    ...customThemes,
                    [`custom_${Date.now()}`]: { ...themeData, name: themeName }
                };
                setCustomThemes(newCustomThemes);
                localStorage.setItem('customThemes', JSON.stringify(newCustomThemes));
                setShowThemeEditor(false);
                setEditingTheme(null);
            };

            const deleteCustomTheme = (themeId) => {
                const newCustomThemes = { ...customThemes };
                delete newCustomThemes[themeId];
                setCustomThemes(newCustomThemes);
                localStorage.setItem('customThemes', JSON.stringify(newCustomThemes));
                if (currentTheme === themeId) {
                    handleThemeChange('default');
                }
            };

            const exportTheme = (themeId) => {
                const allThemes = { ...themes, ...customThemes };
                const theme = allThemes[themeId];
                const themeCode = JSON.stringify(theme, null, 2);
                navigator.clipboard.writeText(themeCode);
                alert('Código do tema copiado!');
            };

            const importTheme = () => {
                const code = prompt('Cole o código do tema:');
                if (code) {
                    try {
                        const themeData = JSON.parse(code);
                        const themeId = `custom_${Date.now()}`;
                        const newCustomThemes = {
                            ...customThemes,
                            [themeId]: themeData
                        };
                        setCustomThemes(newCustomThemes);
                        localStorage.setItem('customThemes', JSON.stringify(newCustomThemes));
                        alert('Tema importado com sucesso!');
                    } catch (e) {
                        alert('Código inválido!');
                    }
                }
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const imageUrl = event.target.result;
                        setCustomBackground(imageUrl);
                        localStorage.setItem('customBackground', imageUrl);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const removeCustomBackground = () => {
                setCustomBackground(null);
                localStorage.removeItem('customBackground');
            };

            // Buscar Rich Presence via Lanyard WebSocket
            useEffect(() => {
                const targetUserId = isPublicView ? publicUserId : userData?.id;
                if (!targetUserId) return;

                const connectLanyard = () => {
                    if (wsRef.current) {
                        wsRef.current.close();
                    }

                    const ws = new WebSocket('wss://api.lanyard.rest/socket');
                    wsRef.current = ws;

                    ws.onopen = () => {
                        console.log('Conectado ao Lanyard');
                    };

                    ws.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        
                        if (data.op === 1) {
                            // Heartbeat
                            setInterval(() => {
                                if (ws.readyState === WebSocket.OPEN) {
                                    ws.send(JSON.stringify({ op: 3 }));
                                }
                            }, data.d.heartbeat_interval);
                            
                            // Subscribe
                            ws.send(JSON.stringify({
                                op: 2,
                                d: {
                                    subscribe_to_id: targetUserId
                                }
                            }));
                        } else if (data.op === 0) {
                            // Presence update
                            setLanyardData(data.d);
                            
                            // Atualizar atividades
                            if (data.d.activities) {
                                setActivities(data.d.activities);
                            }
                            
                            // Atualizar Spotify
                            if (data.d.spotify) {
                                setSpotifyData(data.d.spotify);
                                updateSpotifyProgress(data.d.spotify);
                            } else {
                                setSpotifyData(null);
                            }
                        }
                    };

                    ws.onerror = (error) => {
                        console.error('Erro Lanyard:', error);
                    };

                    ws.onclose = () => {
                        console.log('Lanyard desconectado, reconectando...');
                        setTimeout(connectLanyard, 5000);
                    };
                };

                connectLanyard();

                return () => {
                    if (wsRef.current) {
                        wsRef.current.close();
                    }
                    if (progressIntervalRef.current) {
                        clearInterval(progressIntervalRef.current);
                    }
                };
            }, [userData, isPublicView, publicUserId]);

            const updateSpotifyProgress = (spotify) => {
                if (progressIntervalRef.current) {
                    clearInterval(progressIntervalRef.current);
                }

                if (spotify) {
                    const updateProgress = () => {
                        const now = Date.now();
                        const elapsed = now - spotify.timestamps.start;
                        const duration = spotify.timestamps.end - spotify.timestamps.start;
                        const progress = Math.min((elapsed / duration) * 100, 100);
                        setSpotifyProgress(progress);
                    };

                    updateProgress();
                    progressIntervalRef.current = setInterval(updateProgress, 1000);
                }
            };

            const formatTime = (ms) => {
                const seconds = Math.floor(ms / 1000);
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            const getUserBadges = () => {
                if (!userData?.public_flags) return [];
                
                const badges = [];
                const flags = userData.public_flags;

                const badgeMap = {
                    1: { name: 'Discord Staff', icon: 'https://cdn.discordapp.com/badge-icons/5e74e9b61934fc1f67c65515d1f7e60d.png' },
                    2: { name: 'Partnered Server Owner', icon: 'https://cdn.discordapp.com/badge-icons/3f9748e53446a137a052f3454e2de41e.png' },
                    4: { name: 'HypeSquad Events', icon: 'https://cdn.discordapp.com/badge-icons/bf01d1073931f921909045f3a39fd264.png' },
                    64: { name: 'HypeSquad Bravery', icon: 'https://cdn.discordapp.com/badge-icons/8a88d63823d8a71cd5e390baa45efa02.png' },
                    128: { name: 'HypeSquad Brilliance', icon: 'https://cdn.discordapp.com/badge-icons/011940fd013da3f7fb926e4a1cd2e618.png' },
                    256: { name: 'HypeSquad Balance', icon: 'https://cdn.discordapp.com/badge-icons/3aa41de486fa12454c3761e8e223442e.png' },
                    8: { name: 'Bug Hunter Level 1', icon: 'https://cdn.discordapp.com/badge-icons/2717692c7dca7289b35297368a940dd0.png' },
                    16384: { name: 'Bug Hunter Level 2', icon: 'https://cdn.discordapp.com/badge-icons/848f79194d4be5ff5f81505cbd0ce1e6.png' },
                    4194304: { name: 'Active Developer', icon: 'https://cdn.discordapp.com/badge-icons/6bdc42827a38498929a4920da12695d9.png' },
                    131072: { name: 'Early Verified Bot Developer', icon: 'https://cdn.discordapp.com/badge-icons/6df5892e0f35b051f8b61eace34f4967.png' },
                    512: { name: 'Early Supporter', icon: 'https://cdn.discordapp.com/badge-icons/7060786766c9c840eb3019e725d2b358.png' }
                };

                Object.keys(badgeMap).forEach(flag => {
                    if (flags & parseInt(flag)) {
                        badges.push(badgeMap[flag]);
                    }
                });

                // Nitro badge
                if (userData.premium_type === 1 || userData.premium_type === 2 || userData.premium_type === 3) {
                    badges.push({ 
                        name: 'Discord Nitro', 
                        icon: 'https://cdn.discordapp.com/badge-icons/2ba85e8026a8614b640c2837bcdfe21b.png' 
                    });
                }

                return badges;
            };

            const selectedBg = backgrounds.find(bg => bg.id === background);
            const allThemes = { ...themes, ...customThemes };
            const activeTheme = allThemes[currentTheme] || themes.default;
            
            const backgroundStyle = customBackground 
                ? { backgroundImage: `url(${customBackground})`, backgroundSize: 'cover', backgroundPosition: 'center' }
                : { background: activeTheme.background };

            const cardStyle = {
                background: activeTheme.cardBg,
                border: `1px solid ${activeTheme.cardBorder}`,
                boxShadow: activeTheme.customStyles?.cardShadow || '0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.05)',
                ...(activeTheme.customStyles?.fontFamily && { fontFamily: activeTheme.customStyles.fontFamily })
            };

            if (loading) {
                return (
                    <div className="container">
                        <div className="background" style={backgroundStyle} />
                        <div className="noise" />
                        <div className="content">
                            <div className="profile-card">
                                <div className="skeleton skeleton-avatar" />
                                <div className="skeleton skeleton-text short" />
                                <div className="skeleton skeleton-text medium" />
                            </div>
                        </div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="container">
                        <div className="background" style={backgroundStyle} />
                        <div className="noise" />
                        <div className="content">
                            <div className="login-card">
                                <div style={{ textAlign: 'center', color: '#ed4245', fontSize: '1.2rem', marginBottom: '1rem' }}>
                                    {error}
                                </div>
                                <div style={{ textAlign: 'center', color: 'rgba(255, 255, 255, 0.6)', fontSize: '0.9rem' }}>
                                    Verifique se o usuário entrou no servidor do Lanyard
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (!accessToken && !isPublicView) {
                return (
                    <div className="container">
                        <div className="background" style={backgroundStyle} />
                        <div className="noise" />
                        
                        <div className="content">
                            <div className="login-card">
                                <div className="login-header">
                                    <div className="discord-logo">
                                        <svg width="48" height="48" viewBox="0 0 71 55" fill="white">
                                            <path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527 0.41542C45.5603 0.39851 45.468 0.440769 45.4204 0.525289C44.7963 1.6353 44.105 3.0834 43.6209 4.2216C38.1637 3.4046 32.7345 3.4046 27.3892 4.2216C26.905 3.0581 26.1886 1.6353 25.5617 0.525289C25.5141 0.443589 25.4218 0.40133 25.3294 0.41542C20.2584 1.2888 15.4057 2.8186 10.8776 4.8978C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795C1.57795 18.7309 -0.943561 32.1443 0.293408 45.3914C0.299005 45.4562 0.335386 45.5182 0.385761 45.5576C6.45866 50.0174 12.3413 52.7249 18.1147 54.5195C18.2071 54.5477 18.305 54.5139 18.3638 54.4378C19.7295 52.5728 20.9469 50.6063 21.9907 48.5383C22.0523 48.4172 21.9935 48.2735 21.8676 48.2256C19.9366 47.4931 18.0979 46.6 16.3292 45.5858C16.1893 45.5041 16.1781 45.304 16.3068 45.2082C16.679 44.9293 17.0513 44.6391 17.4067 44.3461C17.471 44.2926 17.5606 44.2813 17.6362 44.3151C29.2558 49.6202 41.8354 49.6202 53.3179 44.3151C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433C53.9057 44.6363 54.2779 44.9293 54.6529 45.2082C54.7816 45.304 54.7732 45.5041 54.6333 45.5858C52.8646 46.6197 51.0259 47.4931 49.0921 48.2228C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383C50.038 50.6034 51.2554 52.5699 52.5959 54.435C52.6519 54.5139 52.7526 54.5477 52.845 54.5195C58.6464 52.7249 64.529 50.0174 70.6019 45.5576C70.6551 45.5182 70.6887 45.459 70.6943 45.3942C72.1747 30.0791 68.2147 16.7757 60.1968 4.9823C60.1772 4.9429 60.1437 4.9147 60.1045 4.8978ZM23.7259 37.3253C20.2276 37.3253 17.3451 34.1136 17.3451 30.1693C17.3451 26.225 20.1717 23.0133 23.7259 23.0133C27.308 23.0133 30.1626 26.2532 30.1066 30.1693C30.1066 34.1136 27.28 37.3253 23.7259 37.3253ZM47.3178 37.3253C43.8196 37.3253 40.9371 34.1136 40.9371 30.1693C40.9371 26.225 43.7636 23.0133 47.3178 23.0133C50.9 23.0133 53.7545 26.2532 53.6986 30.1693C53.6986 34.1136 50.9 37.3253 47.3178 37.3253Z"/>
                                        </svg>
                                    </div>
                                    <div className="login-title">Discord Profile Live</div>
                                    <div className="login-subtitle">Conecte-se com o Discord</div>
                                </div>

                                <button className="login-button" onClick={handleLogin}>
                                    <svg width="24" height="24" viewBox="0 0 71 55" fill="currentColor">
                                        <path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527 0.41542C45.5603 0.39851 45.468 0.440769 45.4204 0.525289C44.7963 1.6353 44.105 3.0834 43.6209 4.2216C38.1637 3.4046 32.7345 3.4046 27.3892 4.2216C26.905 3.0581 26.1886 1.6353 25.5617 0.525289C25.5141 0.443589 25.4218 0.40133 25.3294 0.41542C20.2584 1.2888 15.4057 2.8186 10.8776 4.8978C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795C1.57795 18.7309 -0.943561 32.1443 0.293408 45.3914C0.299005 45.4562 0.335386 45.5182 0.385761 45.5576C6.45866 50.0174 12.3413 52.7249 18.1147 54.5195C18.2071 54.5477 18.305 54.5139 18.3638 54.4378C19.7295 52.5728 20.9469 50.6063 21.9907 48.5383C22.0523 48.4172 21.9935 48.2735 21.8676 48.2256C19.9366 47.4931 18.0979 46.6 16.3292 45.5858C16.1893 45.5041 16.1781 45.304 16.3068 45.2082C16.679 44.9293 17.0513 44.6391 17.4067 44.3461C17.471 44.2926 17.5606 44.2813 17.6362 44.3151C29.2558 49.6202 41.8354 49.6202 53.3179 44.3151C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433C53.9057 44.6363 54.2779 44.9293 54.6529 45.2082C54.7816 45.304 54.7732 45.5041 54.6333 45.5858C52.8646 46.6197 51.0259 47.4931 49.0921 48.2228C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383C50.038 50.6034 51.2554 52.5699 52.5959 54.435C52.6519 54.5139 52.7526 54.5477 52.845 54.5195C58.6464 52.7249 64.529 50.0174 70.6019 45.5576C70.6551 45.5182 70.6887 45.459 70.6943 45.3942C72.1747 30.0791 68.2147 16.7757 60.1968 4.9823C60.1772 4.9429 60.1437 4.9147 60.1045 4.8978ZM23.7259 37.3253C20.2276 37.3253 17.3451 34.1136 17.3451 30.1693C17.3451 26.225 20.1717 23.0133 23.7259 23.0133C27.308 23.0133 30.1626 26.2532 30.1066 30.1693C30.1066 34.1136 27.28 37.3253 23.7259 37.3253ZM47.3178 37.3253C43.8196 37.3253 40.9371 34.1136 40.9371 30.1693C40.9371 26.225 43.7636 23.0133 47.3178 23.0133C50.9 23.0133 53.7545 26.2532 53.6986 30.1693C53.6986 34.1136 50.9 37.3253 47.3178 37.3253Z"/>
                                    </svg>
                                    Entrar com Discord
                                </button>

                                <div className="info-box">
                                    <strong>Recursos:</strong>
                                    <ul className="feature-list">
                                        <li>Perfil completo do Discord</li>
                                        <li>Todas as badges (incluindo Nitro)</li>
                                        <li>Backgrounds personalizáveis</li>
                                        <li>Rich Presence em tempo real</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (!userData) {
                return null;
            }

            // Usuário logado OU visualização pública - mostrar perfil
            const avatarUrl = userData.avatar 
                ? `https://cdn.discordapp.com/avatars/${userData.id}/${userData.avatar}.${userData.avatar.startsWith('a_') ? 'gif' : 'png'}?size=256`
                : 'https://cdn.discordapp.com/embed/avatars/0.png';

            const bannerUrl = userData.banner
                ? `https://cdn.discordapp.com/banners/${userData.id}/${userData.banner}.${userData.banner.startsWith('a_') ? 'gif' : 'png'}?size=600`
                : null;

            return (
                <div className="container" key={currentTheme}>
                    <div className="background" style={backgroundStyle} />
                    <div className="noise" />
                    
                    {currentTheme === 'hellokitty' && (
                        <div className="hello-kitty-hearts">
                            {[...Array(8)].map((_, i) => (
                                <div
                                    key={i}
                                    className="heart"
                                    style={{
                                        left: `${Math.random() * 100}%`,
                                        animationDelay: `${Math.random() * 8}s`,
                                        animationDuration: `${6 + Math.random() * 4}s`
                                    }}
                                >
                                    <svg viewBox="0 0 32 32" fill="#FF69B4" opacity="0.8">
                                        <path d="M16,28.261c0,0-14-7.926-14-17.046c0-9.356,13.159-10.399,14-0.454c1.011-9.938,14-8.903,14,0.454 C30,20.335,16,28.261,16,28.261z"/>
                                    </svg>
                                </div>
                            ))}
                        </div>
                    )}

                    {currentTheme === 'cyberpunk' && (
                        <div className="cyberpunk-scanlines" />
                    )}

                    {currentTheme === 'ocean' && (
                        <div className="ocean-bubbles">
                            {[...Array(8)].map((_, i) => (
                                <div
                                    key={i}
                                    className="bubble"
                                    style={{
                                        left: `${Math.random() * 100}%`,
                                        width: `${12 + Math.random() * 18}px`,
                                        height: `${12 + Math.random() * 18}px`,
                                        animationDelay: `${Math.random() * 6}s`,
                                        animationDuration: `${6 + Math.random() * 6}s`
                                    }}
                                />
                            ))}
                        </div>
                    )}
                    
                    {!isPublicView && (
                        <>
                            <div className={`menu-toggle ${menuOpen ? 'open' : ''}`} onClick={() => setMenuOpen(!menuOpen)}>
                                {menuOpen ? '✕' : '⚙'}
                            </div>

                            <div className={`customizer ${menuOpen ? 'open' : ''}`}>
                        <h3>Configurações</h3>
                        
                        <div className="section">
                            <button 
                                onClick={handleLogout}
                                style={{
                                    width: '100%',
                                    padding: '0.75rem',
                                    background: 'rgba(237, 66, 69, 0.2)',
                                    border: '1px solid rgba(237, 66, 69, 0.4)',
                                    borderRadius: '8px',
                                    color: 'white',
                                    cursor: 'pointer',
                                    fontWeight: '600',
                                    transition: 'all 0.3s ease'
                                }}
                                onMouseOver={(e) => e.target.style.background = 'rgba(237, 66, 69, 0.3)'}
                                onMouseOut={(e) => e.target.style.background = 'rgba(237, 66, 69, 0.2)'}
                            >
                                Sair
                            </button>
                        </div>

                        <div className="section">
                            <div className="section-title">Temas</div>
                            
                            <div style={{ marginBottom: '1rem', display: 'flex', gap: '0.5rem' }}>
                                <button
                                    onClick={createNewTheme}
                                    style={{
                                        flex: 1,
                                        padding: '0.6rem',
                                        background: 'rgba(102, 126, 234, 0.2)',
                                        border: '1px solid rgba(102, 126, 234, 0.4)',
                                        borderRadius: '8px',
                                        color: 'white',
                                        fontSize: '0.8rem',
                                        fontWeight: '600',
                                        cursor: 'pointer'
                                    }}
                                >
                                    + Criar Tema
                                </button>
                                <button
                                    onClick={importTheme}
                                    style={{
                                        flex: 1,
                                        padding: '0.6rem',
                                        background: 'rgba(255, 255, 255, 0.05)',
                                        border: '1px solid rgba(255, 255, 255, 0.1)',
                                        borderRadius: '8px',
                                        color: 'white',
                                        fontSize: '0.8rem',
                                        fontWeight: '600',
                                        cursor: 'pointer'
                                    }}
                                >
                                    Importar
                                </button>
                            </div>

                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: '1fr',
                                gap: '0.5rem'
                            }}>
                                {Object.keys(allThemes).map(themeId => (
                                    <div
                                        key={themeId}
                                        style={{
                                            padding: '1rem',
                                            background: currentTheme === themeId 
                                                ? 'rgba(255, 255, 255, 0.15)' 
                                                : 'rgba(255, 255, 255, 0.05)',
                                            border: currentTheme === themeId
                                                ? `2px solid ${allThemes[themeId].accent}`
                                                : '2px solid rgba(255, 255, 255, 0.1)',
                                            borderRadius: '12px',
                                            transition: 'all 0.3s ease',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '0.75rem'
                                        }}
                                        onMouseOver={(e) => {
                                            if (currentTheme !== themeId) {
                                                e.currentTarget.style.background = 'rgba(255, 255, 255, 0.1)';
                                            }
                                        }}
                                        onMouseOut={(e) => {
                                            if (currentTheme !== themeId) {
                                                e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)';
                                            }
                                        }}
                                    >
                                        <div
                                            onClick={() => handleThemeChange(themeId)}
                                            style={{
                                                width: '40px',
                                                height: '40px',
                                                borderRadius: '8px',
                                                background: allThemes[themeId].background,
                                                border: `2px solid ${allThemes[themeId].cardBorder}`,
                                                flexShrink: 0,
                                                cursor: 'pointer'
                                            }}
                                        />
                                        <div style={{ flex: 1, cursor: 'pointer' }} onClick={() => handleThemeChange(themeId)}>
                                            <div style={{
                                                color: 'white',
                                                fontWeight: '600',
                                                marginBottom: '0.2rem'
                                            }}>
                                                {allThemes[themeId].name}
                                            </div>
                                            <div style={{
                                                fontSize: '0.75rem',
                                                color: 'rgba(255, 255, 255, 0.5)'
                                            }}>
                                                {currentTheme === themeId ? 'Ativo' : 'Clique para ativar'}
                                            </div>
                                        </div>
                                        {themeId.startsWith('custom_') && (
                                            <div style={{ display: 'flex', gap: '0.25rem' }}>
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        exportTheme(themeId);
                                                    }}
                                                    style={{
                                                        padding: '0.4rem 0.6rem',
                                                        background: 'rgba(102, 126, 234, 0.2)',
                                                        border: '1px solid rgba(102, 126, 234, 0.4)',
                                                        borderRadius: '6px',
                                                        color: 'white',
                                                        fontSize: '0.7rem',
                                                        cursor: 'pointer'
                                                    }}
                                                    title="Exportar código"
                                                >
                                                    📋
                                                </button>
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        if (confirm('Deletar este tema?')) {
                                                            deleteCustomTheme(themeId);
                                                        }
                                                    }}
                                                    style={{
                                                        padding: '0.4rem 0.6rem',
                                                        background: 'rgba(237, 66, 69, 0.2)',
                                                        border: '1px solid rgba(237, 66, 69, 0.4)',
                                                        borderRadius: '6px',
                                                        color: 'white',
                                                        fontSize: '0.7rem',
                                                        cursor: 'pointer'
                                                    }}
                                                    title="Deletar tema"
                                                >
                                                    🗑️
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="section">
                            <div className="section-title">Compartilhar Perfil</div>
                            <div style={{
                                padding: '0.75rem',
                                background: 'rgba(255, 255, 255, 0.05)',
                                border: '1px solid rgba(255, 255, 255, 0.1)',
                                borderRadius: '8px',
                                marginBottom: '0.5rem'
                            }}>
                                <div style={{ 
                                    fontSize: '0.75rem', 
                                    color: 'rgba(255, 255, 255, 0.5)',
                                    marginBottom: '0.5rem'
                                }}>
                                    Link Público
                                </div>
                                <div style={{
                                    display: 'flex',
                                    gap: '0.5rem',
                                    alignItems: 'center'
                                }}>
                                    <input 
                                        type="text"
                                        readOnly
                                        value={`${window.location.origin}${window.location.pathname}?id=${userData.id}`}
                                        style={{
                                            flex: 1,
                                            padding: '0.5rem',
                                            background: 'rgba(0, 0, 0, 0.3)',
                                            border: '1px solid rgba(255, 255, 255, 0.1)',
                                            borderRadius: '6px',
                                            color: 'white',
                                            fontSize: '0.8rem',
                                            fontFamily: 'Space Mono, monospace'
                                        }}
                                        onClick={(e) => e.target.select()}
                                    />
                                    <button
                                        onClick={() => {
                                            navigator.clipboard.writeText(`${window.location.origin}${window.location.pathname}?id=${userData.id}`);
                                            alert('Link copiado!');
                                        }}
                                        style={{
                                            padding: '0.5rem 1rem',
                                            background: 'rgba(88, 101, 242, 0.2)',
                                            border: '1px solid rgba(88, 101, 242, 0.4)',
                                            borderRadius: '6px',
                                            color: 'white',
                                            cursor: 'pointer',
                                            fontSize: '0.85rem',
                                            fontWeight: '600',
                                            whiteSpace: 'nowrap'
                                        }}
                                    >
                                        Copiar
                                    </button>
                                </div>
                            </div>
                            <div style={{
                                fontSize: '0.75rem',
                                color: 'rgba(255, 255, 255, 0.5)',
                                lineHeight: '1.4'
                            }}>
                                Compartilhe este link para que outras pessoas vejam seu perfil
                            </div>
                        </div>

                        <div className="section">
                            <div className="section-title">Imagem de Fundo</div>
                            
                            <input 
                                type="file" 
                                ref={fileInputRef}
                                accept="image/*"
                                onChange={handleImageUpload}
                                style={{ display: 'none' }}
                            />
                            
                            <div 
                                onClick={() => !customBackground && fileInputRef.current?.click()}
                                style={{
                                    marginBottom: '1rem',
                                    padding: customBackground ? '0' : '1.5rem',
                                    background: customBackground ? 'transparent' : 'rgba(255, 255, 255, 0.05)',
                                    border: `2px ${customBackground ? 'solid' : 'dashed'} rgba(255, 255, 255, 0.2)`,
                                    borderRadius: '12px',
                                    textAlign: 'center',
                                    cursor: customBackground ? 'default' : 'pointer',
                                    transition: 'all 0.3s ease',
                                    position: 'relative',
                                    overflow: 'hidden',
                                    height: customBackground ? '120px' : 'auto'
                                }}
                                onMouseOver={(e) => {
                                    if (!customBackground) e.currentTarget.style.background = 'rgba(255, 255, 255, 0.08)';
                                }}
                                onMouseOut={(e) => {
                                    if (!customBackground) e.currentTarget.style.background = 'rgba(255, 255, 255, 0.05)';
                                }}
                            >
                                {customBackground ? (
                                    <>
                                        <img 
                                            src={customBackground} 
                                            alt="Background" 
                                            style={{
                                                width: '100%',
                                                height: '100%',
                                                objectFit: 'cover',
                                                borderRadius: '10px'
                                            }}
                                        />
                                        <button 
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                removeCustomBackground();
                                            }}
                                            style={{
                                                position: 'absolute',
                                                top: '0.5rem',
                                                right: '0.5rem',
                                                background: 'rgba(237, 66, 69, 0.9)',
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: '8px',
                                                padding: '0.5rem 0.75rem',
                                                cursor: 'pointer',
                                                fontSize: '0.85rem',
                                                fontWeight: '600',
                                                transition: 'all 0.3s ease'
                                            }}
                                            onMouseOver={(e) => {
                                                e.target.style.background = '#ed4245';
                                                e.target.style.transform = 'scale(1.05)';
                                            }}
                                            onMouseOut={(e) => {
                                                e.target.style.background = 'rgba(237, 66, 69, 0.9)';
                                                e.target.style.transform = 'scale(1)';
                                            }}
                                        >
                                            Remover
                                        </button>
                                    </>
                                ) : (
                                    <>
                                        <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>+</div>
                                        <div style={{ color: 'rgba(255, 255, 255, 0.7)', fontSize: '0.9rem' }}>
                                            Clique para fazer upload
                                        </div>
                                        <div style={{ color: 'rgba(255, 255, 255, 0.5)', fontSize: '0.75rem', marginTop: '0.25rem' }}>
                                            JPG, PNG ou GIF
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>

                        <div className="section">
                            <div className="section-title">Gradientes</div>
                            <div className="bg-options">
                                {backgrounds.map(bg => (
                                    <div
                                        key={bg.id}
                                        className={`bg-option ${background === bg.id && !customBackground ? 'active' : ''}`}
                                        style={{ background: bg.style }}
                                        onClick={() => handleBackgroundChange(bg.id)}
                                        title={bg.name}
                                    />
                                ))}
                            </div>
                        </div>
                    </div>
                        </>
                    )}

                    <div className="content">
                        <div className="profile-card" style={cardStyle}>
                            <div className="avatar-container">
                                <div className="avatar-wrapper" style={currentTheme === 'hellokitty' ? {
                                    border: '5px solid #FF1493',
                                    background: 'white',
                                    boxShadow: '0 4px 20px rgba(255, 20, 147, 0.5)',
                                    overflow: 'hidden'
                                } : {
                                    overflow: 'hidden',
                                    background: '#000'
                                }}>
                                    <img src={avatarUrl} alt="Avatar" className="avatar" />
                                </div>
                            </div>

                            <div className="user-info">
                                <div className="username" style={{ 
                                    color: activeTheme.textPrimary,
                                    ...(activeTheme.customStyles?.textShadow && { 
                                        textShadow: activeTheme.customStyles.textShadow 
                                    })
                                }}>
                                    {userData.global_name || userData.username}
                                </div>
                                <div className="discriminator" style={{ color: activeTheme.textTertiary }}>
                                    @{userData.username}
                                </div>

                                {getUserBadges().length > 0 && (
                                    <div className="badges">
                                        {getUserBadges().map((badge, idx) => (
                                            <img 
                                                key={idx}
                                                src={badge.icon}
                                                alt={badge.name}
                                                title={badge.name}
                                                className="badge"
                                                style={activeTheme.customStyles?.badgeFilter ? {
                                                    filter: activeTheme.customStyles.badgeFilter
                                                } : {}}
                                            />
                                        ))}
                                    </div>
                                )}
                            </div>

                            {/* Spotify */}
                            {spotifyData && (
                                <div className="activity-card" style={{
                                    background: activeTheme.activityBg,
                                    border: `1px solid ${activeTheme.activityBorder}`
                                }}>
                                    <div style={{
                                        fontSize: '0.7rem',
                                        fontWeight: '700',
                                        textTransform: 'uppercase',
                                        letterSpacing: '0.5px',
                                        color: activeTheme.textTertiary,
                                        marginBottom: '0.75rem',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '0.4rem'
                                    }}>
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="#1DB954">
                                            <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
                                        </svg>
                                        Ouvindo no Spotify
                                    </div>
                                    <div className="activity-header">
                                        <img 
                                            src={spotifyData.album_art_url}
                                            alt="Spotify"
                                            className="activity-image"
                                            style={{
                                                borderRadius: '6px'
                                            }}
                                        />
                                        <div className="activity-details">
                                            <div className="activity-name" style={{ color: activeTheme.textPrimary }}>
                                                {spotifyData.song}
                                            </div>
                                            <div className="activity-state" style={{ color: activeTheme.textSecondary }}>
                                                por {spotifyData.artist}
                                            </div>
                                            <div className="activity-info" style={{ color: activeTheme.textTertiary }}>
                                                {spotifyData.album}
                                            </div>
                                        </div>
                                    </div>
                                    <div className="timestamps" style={{ 
                                        color: activeTheme.textTertiary,
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center'
                                    }}>
                                        <span>{formatTime(Date.now() - spotifyData.timestamps.start)}</span>
                                        <span>{formatTime(spotifyData.timestamps.end - spotifyData.timestamps.start)}</span>
                                    </div>
                                    <div className="spotify-bar">
                                        <div className="spotify-progress" style={{ 
                                            width: `${spotifyProgress}%`,
                                            background: activeTheme.spotifyBar
                                        }} />
                                    </div>
                                    {spotifyData.track_id && (
                                        <a
                                            href={`https://open.spotify.com/track/${spotifyData.track_id}`}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            style={{
                                                display: 'inline-flex',
                                                alignItems: 'center',
                                                gap: '0.4rem',
                                                marginTop: '0.75rem',
                                                padding: '0.4rem 0.8rem',
                                                background: '#1DB954',
                                                color: 'white',
                                                borderRadius: '20px',
                                                fontSize: '0.75rem',
                                                fontWeight: '600',
                                                textDecoration: 'none',
                                                transition: 'all 0.2s ease'
                                            }}
                                            onMouseOver={(e) => {
                                                e.target.style.transform = 'scale(1.05)';
                                                e.target.style.boxShadow = '0 4px 12px rgba(29, 185, 84, 0.4)';
                                            }}
                                            onMouseOut={(e) => {
                                                e.target.style.transform = 'scale(1)';
                                                e.target.style.boxShadow = 'none';
                                            }}
                                        >
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
                                            </svg>
                                            Abrir no Spotify
                                        </a>
                                    )}
                                </div>
                            )}

                            {/* Outras Atividades */}
                            {activities.filter(a => a.type === 0).map((activity, idx) => {
                                const getActivityIcon = (activity) => {
                                    if (activity.assets?.large_image) {
                                        if (activity.assets.large_image.startsWith('mp:external')) {
                                            return activity.assets.large_image.replace('mp:external/', 'https://media.discordapp.net/external/');
                                        }
                                        return `https://cdn.discordapp.com/app-assets/${activity.application_id}/${activity.assets.large_image}.png`;
                                    }
                                    return null;
                                };

                                const getSmallIcon = (activity) => {
                                    if (activity.assets?.small_image) {
                                        if (activity.assets.small_image.startsWith('mp:external')) {
                                            return activity.assets.small_image.replace('mp:external/', 'https://media.discordapp.net/external/');
                                        }
                                        return `https://cdn.discordapp.com/app-assets/${activity.application_id}/${activity.assets.small_image}.png`;
                                    }
                                    return null;
                                };
                                
                                const largeIcon = getActivityIcon(activity);
                                const smallIcon = getSmallIcon(activity);
                                
                                return (
                                    <div key={idx} className="activity-card" style={{
                                        background: activeTheme.activityBg,
                                        border: `1px solid ${activeTheme.activityBorder}`
                                    }}>
                                        <div className="activity-header">
                                            <div style={{ position: 'relative' }}>
                                                {largeIcon && (
                                                    <img 
                                                        src={largeIcon}
                                                        alt="Activity"
                                                        className="activity-image"
                                                        title={activity.assets?.large_text}
                                                    />
                                                )}
                                                {smallIcon && (
                                                    <img 
                                                        src={smallIcon}
                                                        alt="Small icon"
                                                        title={activity.assets?.small_text}
                                                        style={{
                                                            position: 'absolute',
                                                            bottom: '-4px',
                                                            right: '-4px',
                                                            width: '20px',
                                                            height: '20px',
                                                            borderRadius: '50%',
                                                            border: `2px solid ${activeTheme.cardBg}`,
                                                            boxShadow: '0 2px 8px rgba(0, 0, 0, 0.3)'
                                                        }}
                                                    />
                                                )}
                                            </div>
                                            <div className="activity-details">
                                                <div className="activity-name" style={{ color: activeTheme.textPrimary }}>
                                                    {activity.name}
                                                </div>
                                                {activity.details && <div className="activity-state" style={{ color: activeTheme.textSecondary }}>
                                                    {activity.details}
                                                </div>}
                                                {activity.state && <div className="activity-info" style={{ color: activeTheme.textTertiary }}>
                                                    {activity.state}
                                                </div>}
                                                
                                                {/* Party Info */}
                                                {activity.party?.size && (
                                                    <div style={{
                                                        fontSize: '0.75rem',
                                                        color: activeTheme.textTertiary,
                                                        marginTop: '0.25rem',
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        gap: '0.25rem'
                                                    }}>
                                                        <span>👥</span>
                                                        <span>{activity.party.size[0]} de {activity.party.size[1]}</span>
                                                    </div>
                                                )}

                                                {activity.timestamps?.start && (
                                                    <div className="timestamps" style={{ color: activeTheme.textTertiary }}>
                                                        {formatTime(Date.now() - activity.timestamps.start)} decorrido
                                                        {activity.timestamps.end && (
                                                            <span> ({formatTime(activity.timestamps.end - Date.now())} restante)</span>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                        </div>

                                        {/* Botões do Rich Presence */}
                                        {activity.buttons && activity.buttons.length > 0 && (
                                            <div style={{
                                                marginTop: '0.75rem',
                                                display: 'flex',
                                                gap: '0.5rem',
                                                flexWrap: 'wrap'
                                            }}>
                                                {activity.buttons.map((button, btnIdx) => (
                                                    <a
                                                        key={btnIdx}
                                                        href={button.url}
                                                        target="_blank"
                                                        rel="noopener noreferrer"
                                                        style={{
                                                            padding: '0.4rem 0.8rem',
                                                            background: activeTheme.accent,
                                                            color: activeTheme.cardBg,
                                                            borderRadius: '6px',
                                                            fontSize: '0.8rem',
                                                            fontWeight: '600',
                                                            textDecoration: 'none',
                                                            transition: 'all 0.2s ease',
                                                            border: `1px solid ${activeTheme.accent}`,
                                                            display: 'inline-block'
                                                        }}
                                                        onMouseOver={(e) => {
                                                            e.target.style.transform = 'translateY(-2px)';
                                                            e.target.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.3)';
                                                        }}
                                                        onMouseOut={(e) => {
                                                            e.target.style.transform = 'translateY(0)';
                                                            e.target.style.boxShadow = 'none';
                                                        }}
                                                    >
                                                        {button.label}
                                                    </a>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {showThemeEditor && editingTheme && (
                        <div className="theme-editor-overlay" onClick={() => setShowThemeEditor(false)}>
                            <div className="theme-editor" onClick={(e) => e.stopPropagation()}>
                                <h2>Criar Tema Customizado</h2>
                                
                                <div className="editor-group">
                                    <label className="editor-label">Nome do Tema</label>
                                    <input
                                        type="text"
                                        className="editor-input"
                                        value={editingTheme.name}
                                        onChange={(e) => setEditingTheme({...editingTheme, name: e.target.value})}
                                        placeholder="Ex: Meu Tema Incrível"
                                    />
                                </div>

                                <div className="editor-group">
                                    <label className="editor-label">Cor de Fundo</label>
                                    <div className="color-input">
                                        <input
                                            type="color"
                                            value={editingTheme.background.startsWith('#') ? editingTheme.background : '#667eea'}
                                            onChange={(e) => setEditingTheme({...editingTheme, background: e.target.value})}
                                        />
                                        <input
                                            type="text"
                                            className="editor-input"
                                            value={editingTheme.background}
                                            onChange={(e) => setEditingTheme({...editingTheme, background: e.target.value})}
                                            placeholder="#667eea ou gradient"
                                        />
                                    </div>
                                </div>

                                <div className="editor-group">
                                    <label className="editor-label">Cor do Card</label>
                                    <input
                                        type="text"
                                        className="editor-input"
                                        value={editingTheme.cardBg}
                                        onChange={(e) => setEditingTheme({...editingTheme, cardBg: e.target.value})}
                                        placeholder="rgba(0, 0, 0, 0.4)"
                                    />
                                </div>

                                <div className="editor-group">
                                    <label className="editor-label">Cor de Texto Principal</label>
                                    <div className="color-input">
                                        <input
                                            type="color"
                                            value={editingTheme.textPrimary.startsWith('#') ? editingTheme.textPrimary : '#ffffff'}
                                            onChange={(e) => setEditingTheme({...editingTheme, textPrimary: e.target.value})}
                                        />
                                        <input
                                            type="text"
                                            className="editor-input"
                                            value={editingTheme.textPrimary}
                                            onChange={(e) => setEditingTheme({...editingTheme, textPrimary: e.target.value})}
                                        />
                                    </div>
                                </div>

                                <div className="editor-group">
                                    <label className="editor-label">Cor de Texto Secundário</label>
                                    <input
                                        type="text"
                                        className="editor-input"
                                        value={editingTheme.textSecondary}
                                        onChange={(e) => setEditingTheme({...editingTheme, textSecondary: e.target.value})}
                                        placeholder="rgba(255, 255, 255, 0.7)"
                                    />
                                </div>

                                <div className="editor-group">
                                    <label className="editor-label">Cor de Destaque (Accent)</label>
                                    <div className="color-input">
                                        <input
                                            type="color"
                                            value={editingTheme.accent.startsWith('#') ? editingTheme.accent : '#667eea'}
                                            onChange={(e) => setEditingTheme({...editingTheme, accent: e.target.value})}
                                        />
                                        <input
                                            type="text"
                                            className="editor-input"
                                            value={editingTheme.accent}
                                            onChange={(e) => setEditingTheme({...editingTheme, accent: e.target.value})}
                                        />
                                    </div>
                                </div>

                                <div className="editor-buttons">
                                    <button 
                                        className="editor-button secondary"
                                        onClick={() => {
                                            setShowThemeEditor(false);
                                            setEditingTheme(null);
                                        }}
                                    >
                                        Cancelar
                                    </button>
                                    <button 
                                        className="editor-button primary"
                                        onClick={() => saveCustomTheme(editingTheme.name, editingTheme)}
                                    >
                                        Salvar Tema
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<DiscordOAuthProfile />, document.getElementById('root'));
    </script>
</body>
</html>